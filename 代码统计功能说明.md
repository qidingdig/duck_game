# 代码统计功能扩展说明

## 概述

已基于 `main_fixed.py` 扩展了代码统计功能，新增了以下特性：

1. **真实代码统计** - 替换了原来的模拟数据，现在可以统计任意目录的实际代码
2. **按语言分类** - 支持30+种编程语言的识别和统计
3. **图形化显示** - 提供柱状图和饼状图可视化
4. **Python函数长度统计** - 统计Python函数的长度分布（均值、中位数、最大值、最小值）

## 主要改动

### 1. 新增文件

- `services/advanced_code_counter.py` - 增强的代码统计工具

### 2. 修改文件

- `main_fixed.py` - 集成了新的代码统计功能

## 功能说明

### 代码统计功能（功能一）

**使用方法**：
1. 运行游戏：`python main_fixed.py`
2. 点击唐老鸭打开对话框
3. 输入"我要统计代码量"
4. 程序会自动：
   - 统计当前项目目录（`G:\g3_fall\se\duck_game`）的代码
   - 在对话框显示文本统计报告
   - 弹出图形化窗口显示图表

**支持的语言**：
- Python (.py, .pyw)
- Java (.java)
- C/C++ (.c, .cpp, .h, .hpp)
- C# (.cs)
- JavaScript/TypeScript (.js, .ts, .jsx, .tsx)
- Vue (.vue)
- Go (.go)
- Rust (.rs)
- Swift (.swift)
- Kotlin (.kt)
- Scala (.scala)
- PHP (.php)
- Ruby (.rb)
- SQL (.sql)
- HTML/CSS (.html, .css, .scss, .less)
- 以及其他30+种编程语言

**图形化功能**：
- **柱状图**：显示各语言的代码行数，带数值标签
- **饼状图**：显示各语言代码量的占比
- 图表可以切换查看
- 显示前10种代码量最多的语言

### Python函数长度统计（功能二）

**统计指标**：
- 总函数数
- 平均长度（均值）
- 中位数长度
- 最小长度
- 最大长度

**可视化**：
- 函数长度分布直方图
- 标注平均值和中位数的参考线
- 显示详细的统计信息

## 技术实现

### 核心模块

1. **AdvancedCodeCounter** (`services/advanced_code_counter.py`)
   - 代码行统计：支持单行注释、多行注释识别
   - 语言识别：基于文件扩展名映射
   - 函数分析：使用Python AST模块解析函数定义

2. **图形化界面**（集成在 `main_fixed.py` 中）
   - 使用matplotlib生成图表
   - 使用Tkinter显示图表窗口
   - 支持实时切换图表类型

### 代码统计流程

1. 遍历目录下的所有文件
2. 识别二进制文件并跳过
3. 根据文件扩展名识别编程语言
4. 逐行分析代码、注释、空行
5. 按语言汇总统计
6. 生成文本报告和图表

### Python函数统计流程

1. 找到所有Python文件
2. 使用AST解析Python代码
3. 识别函数定义（包括普通函数和异步函数）
4. 计算每个函数的行数（从函数定义行到结束行）
5. 计算统计指标：均值、中位数、最小值、最大值

## 使用示例

### 启动统计

```
运行游戏 → 点击唐老鸭 → 输入"我要统计代码量"
```

### 统计结果示例

**文本报告**：
```
代码统计报告:
==================================================
总文件数: 25
总行数: 5234
代码行数: 3892
注释行数: 234
空行数: 1108
耗时: 0.123 秒

按语言统计:
语言                 文件数       代码行数
--------------------------------------------------
Python               15           2345
JavaScript           8            987
CSS                  2            560
```

**Python函数统计**：
```
Python函数统计:
总函数数: 87
平均长度: 23.45 行
中位数长度: 18.50 行
最小长度: 2 行
最大长度: 156 行
```

## 依赖要求

确保已安装以下依赖（已在 `requirements.txt` 中）：

```bash
pygame>=2.6.0
matplotlib>=3.7.2
```

如果未安装，运行：
```bash
pip install -r requirements.txt
```

## 注意事项

1. **统计大目录**：如果项目目录很大，统计可能需要一些时间，请耐心等待
2. **二进制文件**：自动跳过二进制文件（如图片、编译后的文件等）
3. **默认排除**：自动排除 `.git`, `node_modules`, `.venv`, `dist`, `build` 等目录
4. **编码问题**：自动检测文件编码（UTF-8, UTF-16等）
5. **图表显示**：如果matplotlib未安装，会显示警告，但文本统计仍可使用

## 扩展建议

如果需要统计其他目录，可以修改 `main_fixed.py` 中的 `start_code_counting` 方法：

```python
# 当前：统计项目目录
current_dir = os.path.dirname(os.path.abspath(__file__))

# 可以改为统计其他目录：
# current_dir = r"G:\your_project_path"
```

## 故障排除

**问题**：图表无法显示
- **解决**：确保已安装matplotlib：`pip install matplotlib`

**问题**：统计速度慢
- **解决**：正常现象，大目录统计需要时间。可以添加更具体的include/exclude规则

**问题**：中文字符显示问题
- **解决**：已在代码中处理了编码检测，如仍有问题，请检查系统字体

## 更新日志

- 2024-XX-XX: 基于main_fixed.py扩展代码统计功能
  - 添加真实代码统计（替换模拟数据）
  - 添加按语言分类统计
  - 添加图形化显示（柱状图、饼状图）
  - 添加Python函数长度统计


